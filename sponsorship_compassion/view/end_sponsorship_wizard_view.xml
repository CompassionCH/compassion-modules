<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2014 Compassion (http://www.compassion.ch)
    @author Emanuel Cino <ecino@compassion.ch>
    The licence is in the file __openerp__.py
-->
<openerp>
    <data>
		<record id="end_sponsorship_view" model="ir.ui.view">
			<field name="name">end.sponsorship.wizard.view</field>
			<field name="model">end.sponsorship.wizard</field>
			<field name="arch" type="xml">
				<form string="End of sponsorship" version="7.0">
                    <field name="state" invisible="1" />
                    
                    <!-- End sponsorship form -->
                    <sheet states="end_sponsorship">
                        <group>
                            <field name="contract_id" readonly="1"/>
                            <field name="child_id" readonly="1"/>
                            <field name="end_date"/>
                            <field name="end_reason"/>
                        </group>
                    </sheet>

                    <!-- Transfer child form -->
                    <sheet states="transfer_child">
                        <group>
                            <field name="do_transfer" />
                            <!-- on_change="on_change_do_transfer(do_transfer)" -->
                            <!-- invisible="[('do_transfer', '=', 'False')]" -->
                            <field name="transfer_country_id" options="{'limit': 20}"
                                   attrs="{'invisible': [('do_transfer', '=', False)],
                                           'required': [('do_transfer', '=', 'True')]}" />
                        </group>
                    </sheet>
                    
                    <!-- Child Exit Details form -->
                    <sheet states="exit_details">
                        <group>
                            <field name="gp_exit_reason" attrs="{'required': [('state', '=', 'exit_details')]}"/>
                        </group>
                    </sheet>
                    
                    <!-- Action buttons in footer -->
					<footer>
						<button name="end_sponsorship" string="End sponsorship" 
                                type="object" class="oe_highlight" states="end_sponsorship"/>
                        <button name="transfer_child" string="Confirm"
                                type="object" class="oe_highlight" states="transfer_child"/>
                        <button name="depart_child" string="Confirm"
                                type="object" class="oe_highlight" states="exit_details"/>
						or
						<button string="Cancel" class="oe_link" special="cancel"/>
					</footer>
				</form>
			</field>
		</record>

        <record id="action_end_sponsorship" model="ir.actions.act_window">
             <field name="name">End Sponsorship</field>
             <field name="res_model">end.sponsorship.wizard</field>
             <field name="src_model">recurring.contract</field>
             <field name="type">ir.actions.act_window</field>
             <field name="view_type">form</field>
             <field name="view_mode">form</field>
             <field name="view_id" ref="end_sponsorship_view"/>
             <field name="context">{'active_id': active_id}</field>
             <field name="target">new</field>
       </record>

        
    </data>
</openerp>
