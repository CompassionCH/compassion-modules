<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_recurring_contract_tree_compassion" model="ir.ui.view">
        <field name="name">recurring.contract.compassion.tree</field>
        <field name="model">recurring.contract</field>
        <field name="inherit_id" ref="recurring_contract.view_recurring_contract_tree"/>
        <field name="arch" type="xml">
            <field name="partner_id" position="after">
                <field name="child_code" />
            </field>
            <field name="reference" position="replace" />
        </field>
    </record>

    <!--pylint:disable=dangerous-view-replace-wo-priority-->
    <record id="view_recurring_contract_form_compassion" model="ir.ui.view">
        <field name="name">recurring.contract.compassion.form</field>
        <field name="model">recurring.contract</field>
        <field name="inherit_id" ref="recurring_contract.view_recurring_contract_form"/>
        <field name="arch" type="xml">
            <!-- Hide reference -->
            <field name="reference" position="replace">
                <field name="name"/>
            </field>

            <field name="group_id" position="after">
                <field name="parent_id" domain="[('partner_id', '=', partner_id), ('child_id', '!=', child_id), ('sub_sponsorship_id', '=', False), ('sponsorship_line_id', '!=', False)]"
                                   context="{'default_type':'S'}"/>
                <field name="sub_sponsorship_id" states="terminated" context="{'default_type':'S'}"/>
            </field>
            <field name="medium_id" position="before">
                <field name="child_id" domain="[('state', 'in', ('N', 'I'))]" options="{'create': false, 'm2o_dialog': false, 'create_edit': false}"/>
                <field name="origin_id"/>
            </field>
            <field name="last_paid_invoice_date" position="before">
                <field name="type"/>
                <field name="group_freq"/>
                <field name="months_paid"/>
            </field>
        </field>
    </record>

    <!--pylint:disable=dangerous-view-replace-wo-priority-->
    <record id="view_recurring_contract_compassion_filter" model="ir.ui.view">
        <field name="name">recurring.contract.compassion.select</field>
        <field name="model">recurring.contract</field>
        <field name="inherit_id" ref="recurring_contract.view_recurring_contract_filter" />
        <field name="arch" type="xml">
            <field name="reference" position="attributes">
                <attribute name="filter_domain">
                    ['|', '|', '|', '|', '|', '|',
                    ('reference','ilike',self),
                    ('partner_id','child_of',self),
                    ('payment_mode_id', 'ilike', self),
                    ('partner_codega', 'ilike', self),
                    ('child_code', 'ilike', self),
                    ('child_name', 'ilike', self),
                    ('origin_id', 'ilike', self),
                    ]
                </attribute>
            </field>
            <field name="payment_mode_id" position="after">
                <field name="origin_id"/>
            </field>
            <xpath expr="//filter[@name='state']" position="after">
                <separator />
                <filter name="group_type" string="Origin" domain="[]"  context="{'group_by':'origin_id'}"/>
            </xpath>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_contract">
        <field name="name">Contracts</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">recurring.contract</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'default_type':'O'}</field>
    </record>

    <!-- Put Invoicing section in Accounting/Customers Menu -->
    <menuitem id="recurring_contract.menu_recurring_contract_form" parent="account.menu_finance_receivables"
              name="Contracts" sequence="11" action="action_contract"/>
    <menuitem id="recurring_contract.menu_invoice_automatic_generation" name="Launch invoices generation" parent="account.menu_finance_receivables" sequence="12"/>
    <menuitem id="recurring_contract.menu_recurring_invoicer_form" name="Generated invoices" parent="account.menu_finance_receivables" sequence="13"/>

    <!-- Delete useless menu entries in the Accounting section -->
    <delete model="ir.ui.menu" id="recurring_contract.menu_contracts_section"/>
</odoo>
