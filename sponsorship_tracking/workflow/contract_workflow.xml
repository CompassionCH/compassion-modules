<?xml version="1.0" encoding="utf-8"?>
<!--
    Copyright (C) 2015 Compassion (http://www.compassion.ch)
    @author David Coninckx <david@coninckx.com>
    The licence is in the file __openerp__.py
-->
<openerp>
    <data>
        <!-- Override activities -->
         <record model="workflow.activity" id="sponsorship_compassion.act_validation">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">validation</field>
            <field name="kind">function</field>
            <field name="action">contract_validation()</field>
        </record>
        
        <!-- Activities -->
        <record model="workflow.activity" id="act_draft">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">draft</field>
            <field name="kind">function</field>
            <field name="action">draft()</field>
            <field name="flow_start" eval='True' />
        </record>
        
        <record model="workflow.activity" id="act_start">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">start</field>
            <field name="kind">function</field>
            <field name="action">start()</field>
        </record>
        
        <record model="workflow.activity" id="act_waiting_welcome">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">waiting_welcome</field>
            <field name="kind">function</field>
            <field name="action">waiting_welcome()</field>
        </record>
        
        <record model="workflow.activity" id="act_active">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">active</field>
            <field name="kind">function</field>
            <field name="action">activate()</field>
        </record>

        <record model="workflow.activity" id="act_cancelled">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">cancelled</field>
            <field name="kind">function</field>
            <field name="action">cancel()</field>
        </record>
        
        <record model="workflow.activity" id="act_sub_waiting">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">sub_waiting</field>
            <field name="kind">function</field>
            <field name="action">waiting_for_sub()</field>
        </record>
        
        <record model="workflow.activity" id="act_no_sub">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">no_sub</field>
            <field name="kind">function</field>
            <field name="action">no_sub()</field>
        </record>
        
        <record model="workflow.activity" id="act_sub">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">sub</field>
            <field name="kind">function</field>
            <field name="action">sub()</field>
        </record>
        
        <record model="workflow.activity" id="act_sub_accept">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">sub_accept</field>
            <field name="kind">function</field>
            <field name="action">sub_accept()</field>
        </record>
        
        <record model="workflow.activity" id="act_sub_reject">
            <field name="wkf_id" ref="recurring_contract.wkf_recurring_contract" />
            <field name="name">sub_reject</field>
            <field name="kind">function</field>
            <field name="action">sub_reject()</field>
        </record>

        <!-- Transitions -->
        <record model="workflow.transition" id="t0">
            <field name="act_from" ref="act_draft" />
            <field name="act_to" ref="act_start" />
            <field name="signal">contract_validated</field>
        </record>

        <record model="workflow.transition" id="t1a">
            <field name="act_from" ref="act_start" />
            <field name="act_to" ref="act_waiting_welcome" />
            <field name="signal">mail_sent</field>
            <field name="condition">correspondant_id.email</field>
        </record>

         <record model="workflow.transition" id="t1b">
            <field name="act_from" ref="act_start" />
            <field name="act_to" ref="act_active" />
            <field name="signal">mail_sent</field>
        </record>
        
        <record model="workflow.transition" id="t2">
            <field name="act_from" ref="act_waiting_welcome" />
            <field name="act_to" ref="act_active" />
            <field name="signal">welcome_sent</field>
        </record>
        
        <record model="workflow.transition" id="t5a">
            <field name="act_from" ref="act_active" />
            <field name="act_to" ref="act_sub_waiting" />
            <field name="signal">contract_terminated</field>
            <field name="condition">end_reason=='1'</field>
        </record>
        
        <record model="workflow.transition" id="t5b">
            <field name="act_from" ref="act_active" />
            <field name="act_to" ref="act_cancelled" />
            <field name="signal">contract_terminated</field>
            <field name="condition">end_reason!='1'</field>
        </record>

        <record model="workflow.transition" id="t5c">
            <field name="act_from" ref="act_start" />
            <field name="act_to" ref="act_cancelled" />
            <field name="signal">contract_terminated</field>
        </record>

        <record model="workflow.transition" id="t5d">
            <field name="act_from" ref="act_waiting_welcome" />
            <field name="act_to" ref="act_cancelled" />
            <field name="signal">contract_terminated</field>
        </record>
        
        <record model="workflow.transition" id="t6">
            <field name="act_from" ref="act_sub_waiting" />
            <field name="act_to" ref="act_no_sub" />
            <field name="signal">no_sub</field>
        </record>

        <record model="workflow.transition" id="t7">
            <field name="act_from" ref="act_sub_waiting" />
            <field name="act_to" ref="act_sub" />
            <field name="signal">new_contract_validated</field>
        </record>
        
        <record model="workflow.transition" id="t8a">
            <field name="act_from" ref="act_sub" />
            <field name="act_to" ref="act_sub_accept" />
            <field name="signal">sub_accept</field>
        </record>
        
        <record model="workflow.transition" id="t8b">
            <field name="act_from" ref="act_sub" />
            <field name="act_to" ref="act_sub_reject" />
            <field name="signal">sub_reject</field>
        </record>
    </data>
</openerp>
