<?xml version="1.0"?>
<odoo>
    <!-- Search view -->
    <record id="support_search_view" model="ir.ui.view">
        <field name="name">support.search.view</field>
        <field name="model">crm.claim</field>
        <field name="inherit_id" ref="crm_claim.view_crm_case_claims_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[1]" position="attributes">
                <attribute name="string">Unassigned</attribute>
                <attribute name="name">unassigned</attribute>
            </xpath>
            <field name="partner_id" position="before">
                <filter string="Assign to me" name="responsible"
                        domain="[('user_id','=',uid)]"/>
            </field>
            <field name="user_id" position="after">
                <separator/>
                <filter string="Request open" name="stage_open"
                        domain="[('stage_id', '!=', %(crm_claim.stage_claim2)d),('stage_id', '!=', %(crm_claim.stage_claim3)d)]"/>
            </field>
        </field>
    </record>

    <!-- Kanban view -->
    <record id="crm_request_kanban_view" model="ir.ui.view">
        <field name="name">CRM - Requests Kanban</field>
        <field name="model">crm.claim</field>
        <field name="type">kanban</field>
        <field name="arch" type="xml">
            <kanban default_group_by="stage_id"
                    group_create='false'
                    group_delete='false'
                    group_edit="false"
                    quick_create='false'>
                <field name='partner_id'/>
                <field name='color'/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="#{kanban_color(record.color.raw_value)}">
                            <div class="oe_kanban_vignette">
                                <div class='oe_kanban_card'>
                                    <h4>
                                        <a type="open">
                                            <field name="name"/>
                                        </a>
                                    </h4>
                                    <ul>
                                        <li>
                                            <field name='partner_id'/>
                                        </li>
                                        <li>
                                            <field name='ref'/>
                                        </li>
                                        <li>

                                        </li>
                                    </ul>
                                </div>
                                <div class='oe_kanban_bottom_right'>
                                    <field name='user_id'/>
                                </div>
                                <div class='oe_kanban_footer_left'>
                                    <field name='date'/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <!-- Form view -->
    <record model="ir.ui.view" id="crm_request_form_view">
        <field name="name">CRM - Requests Form</field>
        <field name="model">crm.claim</field>
        <field name="inherit_id" ref="crm_claim.crm_case_claims_form_view"/>
        <field name="arch" type="xml">
            <field name="stage_id" position="before">
                <button name="action_reply" string="Reply" type="object" class="btn-primary"/>
            </field>
            <xpath expr="//page[1]" position="attributes">
                <attribute name="string">Request Description</attribute>
            </xpath>
            <xpath expr="//page[1]/group/separator" position="attributes">
                <attribute name="string">Reporter</attribute>
            </xpath>
            <xpath expr="//page[1]/separator" position="attributes">
                <attribute name="string">Description</attribute>
            </xpath>

            <field name="team_id" position="after">
                <field name="alias_id" groups="base.group_no_one"/>
            </field>

            <field name="claim_type" position="attributes">
                <attribute name="string">Type</attribute>
            </field>

            <field name="description" position="attributes">
                <attribute name="widget">text_collapse_html</attribute>
            </field>

        </field>
    </record>

    <!-- Action -->
    <record model="ir.actions.act_window" id="request_action">
        <field name="name">Requests</field>
        <field name="res_model">crm.claim</field>
        <field name="view_type">form</field>
        <field name="view_mode">kanban,tree,calendar,form</field>
        <field name="view_id" ref="crm_request_kanban_view"/>
        <field name="context">
            {"search_default_responsible":1,
            "search_default_unassigned":1,
            "search_default_stage_open":1,
            "stage_type":'claim'}
        </field>
        <field name="search_view_id"
               ref="crm_claim.view_crm_case_claims_filter"/>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
                Record and track your customers' requests. Requests may be
                linked to a sales order or a lot.You can send emails with
                attachments and keep the full history for a request (emails
                sent, intervention type and so on).Requests may automatically
                be linked to an email address using the mail gateway module.
            </p>
        </field>
    </record>

    <!-- Top menu -->
    <menuitem id="support_root"
              name="Support"
              groups="sales_team.group_sale_salesman"
              sequence="1"
              web_icon="crm_request,static/description/icon.png"/>

    <menuitem id="menu_crm_case_claims" name="Requests"
              parent="support_root" action="request_action" sequence="0"
              groups="sales_team.group_sale_salesman"/>

    <!-- Configuration menu-->
    <menuitem id="crm_claim.menu_config_claim" name="Configuration"
              parent="support_root" sequence="10"
              groups="sales_team.group_sale_manager"/>
    <menuitem id="crm_claim_type.menu_crm_claim_type_act" name="Types"
              groups="sales_team.group_sale_manager"
              parent="crm_claim.menu_config_claim"/>

</odoo>
